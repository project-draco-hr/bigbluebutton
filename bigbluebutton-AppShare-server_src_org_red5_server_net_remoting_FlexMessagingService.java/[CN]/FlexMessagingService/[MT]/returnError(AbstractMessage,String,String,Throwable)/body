{
  ErrorMessage result=returnError(request,faultCode,faultString,"");
  if (error instanceof ClientDetailsException) {
    result.extendedData=((ClientDetailsException)error).getParameters();
    if (((ClientDetailsException)error).includeStacktrace()) {
      StringBuilder stack=new StringBuilder();
      for (      StackTraceElement element : error.getStackTrace()) {
        stack.append(element.toString()).append("\n");
      }
      result.faultDetail=stack.toString();
    }
  }
  return result;
}
