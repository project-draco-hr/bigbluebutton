{
  ServletContext ctx=servletContext.getContext(webAppKey);
  if (ctx == null) {
    ctx=servletContext;
  }
  ContextLoader loader=new ContextLoader();
  ConfigurableWebApplicationContext appCtx=(ConfigurableWebApplicationContext)loader.initWebApplicationContext(ctx);
  appCtx.setParent(applicationContext);
  appCtx.refresh();
  ctx.setAttribute(WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE,appCtx);
  ConfigurableBeanFactory appFactory=appCtx.getBeanFactory();
  logger.debug("About to grab Webcontext bean for " + webAppKey);
  Context webContext=(Context)appCtx.getBean("web.context");
  webContext.setCoreBeanFactory(parentFactory);
  webContext.setClientRegistry(clientRegistry);
  webContext.setServiceInvoker(globalInvoker);
  webContext.setScopeResolver(globalResolver);
  webContext.setMappingStrategy(globalStrategy);
  WebScope scope=(WebScope)appFactory.getBean("web.scope");
  scope.setServer(server);
  scope.setParent(global);
  scope.register();
  scope.start();
  registeredContexts.add(ctx);
}
