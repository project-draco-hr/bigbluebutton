{
  String path=req.getContextPath() + req.getServletPath();
  if (path.startsWith("/")) {
    path=path.substring(1);
  }
  path=path.substring(0,path.length() - getServletName().length() - 1);
  IGlobalScope global=server.lookupGlobal(req.getServerName(),path);
  if (global == null) {
    global=server.lookupGlobal(req.getLocalName(),path);
    if (global == null) {
      global=server.lookupGlobal(req.getLocalAddr(),path);
    }
  }
  return global;
}
