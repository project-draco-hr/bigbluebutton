{
  logger.info("Webapp shutdown");
  try {
    Introspector.flushCaches();
    for (Enumeration e=DriverManager.getDrivers(); e.hasMoreElements(); ) {
      Driver driver=(Driver)e.nextElement();
      if (driver.getClass().getClassLoader() == getClass().getClassLoader()) {
        DriverManager.deregisterDriver(driver);
      }
    }
    JMXAgent.shutdown();
    ConfigurableWebApplicationContext applicationContext=(ConfigurableWebApplicationContext)servletContext.getAttribute(WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE);
    ConfigurableBeanFactory factory=applicationContext.getBeanFactory();
    if (factory.containsSingleton("default.context")) {
      for (      String scope : factory.getRegisteredScopeNames()) {
        logger.debug("Registered scope: " + scope);
      }
      for (      String singleton : factory.getSingletonNames()) {
        logger.debug("Registered singleton: " + singleton);
      }
      factory.destroySingletons();
    }
    servletContext.removeAttribute(WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE);
    applicationContext.close();
  }
 catch (  Throwable e) {
    e.printStackTrace();
  }
}
