{
  if (this.resultSent)   throw new RuntimeException("You can only set the result once.");
  this.resultSent=true;
  Channel channel=this.channel.get();
  if (channel == null) {
    log.warn("The client is no longer connected.");
    return;
  }
  Invoke reply=new Invoke();
  call.setResult(result);
  reply.setCall(call);
  reply.setInvokeId(invokeId);
  channel.write(reply);
  channel.getConnection().unregisterDeferredResult(this);
}
