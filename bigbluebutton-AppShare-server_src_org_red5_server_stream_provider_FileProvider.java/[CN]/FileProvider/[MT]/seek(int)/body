{
  if (keyFrameMeta == null) {
    if (!(reader instanceof IKeyFrameDataAnalyzer)) {
      return ts;
    }
    keyFrameMeta=((IKeyFrameDataAnalyzer)reader).analyzeKeyFrames();
  }
  if (keyFrameMeta.positions.length == 0) {
    return ts;
  }
  if (ts >= keyFrameMeta.duration) {
    reader.position(Long.MAX_VALUE);
    return (int)keyFrameMeta.duration;
  }
  int frame=0;
  for (int i=0; i < keyFrameMeta.positions.length; i++) {
    if (keyFrameMeta.timestamps[i] > ts) {
      break;
    }
    frame=i;
  }
  reader.position(keyFrameMeta.positions[frame]);
  return keyFrameMeta.timestamps[frame];
}
