{
synchronized (instance) {
    logger.info("Webapp shutdown");
    try {
      ServletContext ctx=sce.getServletContext();
      if (ctx.getContextPath().equals("/ROOT")) {
        timer.cancel();
      }
 else {
        registeredContexts.remove(ctx);
      }
      Introspector.flushCaches();
      for (Enumeration e=DriverManager.getDrivers(); e.hasMoreElements(); ) {
        Driver driver=(Driver)e.nextElement();
        if (driver.getClass().getClassLoader() == getClass().getClassLoader()) {
          DriverManager.deregisterDriver(driver);
        }
      }
      JMXAgent.shutdown();
      Object attr=ctx.getAttribute(WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE);
      if (attr != null) {
        ConfigurableWebApplicationContext applicationContext=(ConfigurableWebApplicationContext)attr;
        ConfigurableBeanFactory factory=applicationContext.getBeanFactory();
        try {
          for (          String singleton : factory.getSingletonNames()) {
            logger.debug("Registered singleton: " + singleton);
            factory.destroyScopedBean(singleton);
          }
        }
 catch (        RuntimeException e) {
        }
        factory.destroySingletons();
        ctx.removeAttribute(WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE);
        applicationContext.close();
      }
      instance.getContextLoader().closeWebApplicationContext(ctx);
    }
 catch (    Throwable e) {
      e.printStackTrace();
    }
 finally {
    }
  }
}
