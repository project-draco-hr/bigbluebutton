{
  if (rtpSocket == null) {
    return;
  }
  asao_buffer_processed=false;
  if (!hasInitilializedBuffers) {
    tempBuffer=new float[NELLYMOSER_DECODED_PACKET_SIZE];
    encodingBuffer=new float[sipCodec.getOutgoingDecodedFrameSize()];
    hasInitilializedBuffers=true;
  }
  if (num > 0) {
    do {
      int encodedBytes=fillRtpPacketBuffer(asaoBuffer);
      if (encodedBytes == 0) {
        break;
      }
      if (encodingOffset == sipCodec.getOutgoingDecodedFrameSize()) {
        try {
          rtpPacket.setSequenceNumber(seqn++);
          rtpPacket.setTimestamp(time);
          rtpPacket.setPayloadLength(sipCodec.getOutgoingEncodedFrameSize());
          rtpSocketSend(rtpPacket);
        }
 catch (        Exception e) {
          println("send",sipCodec.getCodecName() + " encoder error.");
        }
        encodingOffset=0;
      }
    }
 while (!asao_buffer_processed);
  }
 else   if (num < 0) {
    println("send","Closing");
  }
}
