{
  ByteBuffer tmp=ByteBuffer.allocate(0);
  tmp.setAutoExpand(true);
  DeflaterOutputStream deflater=new DeflaterOutputStream(tmp.asOutputStream(),new Deflater(Deflater.BEST_COMPRESSION));
  byte[] tmpData=new byte[data.limit()];
  data.position(0);
  data.get(tmpData);
  try {
    deflater.write(tmpData);
    deflater.finish();
  }
 catch (  IOException e) {
    tmp.release();
    throw new RuntimeException("could not compress data",e);
  }
  data.release();
  data=tmp;
  data.flip();
  prepareIO();
}
