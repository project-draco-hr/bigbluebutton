{
  IRTMPEvent packet=message.getBody();
  if (!(packet instanceof VideoData)) {
    return;
  }
  VideoData video=(VideoData)packet;
  FrameType type=video.getFrameType();
switch (state) {
case SEND_ALL:
    if (type == FrameType.DISPOSABLE_INTERFRAME) {
      return;
    }
 else     if (type == FrameType.INTERFRAME) {
      state=SEND_KEYFRAMES;
      return;
    }
 else     if (type == FrameType.KEYFRAME) {
      state=SEND_KEYFRAMES;
      return;
    }
  break;
case SEND_INTERFRAMES:
if (type == FrameType.INTERFRAME) {
  state=SEND_KEYFRAMES_CHECK;
  return;
}
 else if (type == FrameType.KEYFRAME) {
  state=SEND_KEYFRAMES;
  return;
}
break;
case SEND_KEYFRAMES:
break;
case SEND_KEYFRAMES_CHECK:
if (type == FrameType.KEYFRAME) {
state=SEND_KEYFRAMES;
return;
}
break;
default :
}
}
