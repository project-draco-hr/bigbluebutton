{
  if (message.getMessageType() == Message.MessageType.BLOCK) {
    long start=System.currentTimeMillis();
    Integer[] changedBlocks=((BlockMessage)message).getBlocks();
    for (int i=0; i < changedBlocks.length; i++) {
      EncodedBlockData block=retriever.getBlockToSend((Integer)changedBlocks[i]);
      BlockVideoData bv=new BlockVideoData(room,block.getPosition(),block.getVideoData(),false);
      sendBlockData(bv);
    }
    for (int i=0; i < changedBlocks.length; i++) {
      retriever.blockSent((Integer)changedBlocks[i]);
    }
    long end=System.currentTimeMillis();
    System.out.println("[HTTP tunnel] Sending " + changedBlocks.length + " blocks took "+ (end - start)+ " millis");
  }
 else   if (message.getMessageType() == Message.MessageType.CURSOR) {
    CursorMessage msg=(CursorMessage)message;
    sendCursor(msg.getMouseLocation(),msg.getRoom());
  }
}
