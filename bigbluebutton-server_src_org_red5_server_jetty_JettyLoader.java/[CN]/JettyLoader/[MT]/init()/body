{
  try {
    if (webappFolder == null) {
      webappFolder=System.getProperty("red5.root") + "/webapps";
    }
    System.setProperty("red5.webapp.root",webappFolder);
    log.info("Loading jetty6 context from: " + jettyConfig);
    ApplicationContext appCtx=new ClassPathXmlApplicationContext(jettyConfig);
    jetty=(Server)appCtx.getBean("Server");
    setApplicationLoader(new JettyApplicationLoader(jetty,applicationContext.get()));
    String serverRoot=System.getProperty("red5.root");
    if (log.isDebugEnabled()) {
      log.debug("Server root: " + serverRoot);
    }
    System.setProperty("jetty.home",serverRoot);
    System.setProperty("jetty.class.path",serverRoot + "/lib");
    log.info("Starting jetty servlet engine");
    String[] handlersArr=new String[]{"org.mortbay.jetty.webapp.WebInfConfiguration","org.mortbay.jetty.webapp.WebXmlConfiguration","org.mortbay.jetty.webapp.JettyWebXmlConfiguration","org.mortbay.jetty.webapp.TagLibConfiguration","org.red5.server.jetty.Red5WebPropertiesConfiguration"};
    HandlerCollection handlers=new HandlerCollection();
    handlers.setHandlers(new Handler[]{new ContextHandlerCollection(),new DefaultHandler()});
    jetty.setHandler(handlers);
    try {
      HandlerCollection contexts=(HandlerCollection)jetty.getChildHandlerByClass(ContextHandlerCollection.class);
      if (contexts == null)       contexts=(HandlerCollection)jetty.getChildHandlerByClass(HandlerCollection.class);
      WebAppDeployer deployer=new WebAppDeployer();
      deployer.setContexts(contexts);
      deployer.setWebAppDir(webappFolder);
      deployer.setDefaultsDescriptor(defaultWebConfig);
      deployer.setConfigurationClasses(handlersArr);
      deployer.setExtract(true);
      deployer.setParentLoaderPriority(true);
      deployer.start();
    }
 catch (    IOException e) {
      log.error("{}",e);
    }
catch (    Exception e) {
      log.error("{}",e);
    }
    jetty.start();
  }
 catch (  Exception e) {
    log.error("Error loading jetty",e);
  }
}
