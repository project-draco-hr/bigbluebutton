{
  final ManagerResponse response;
  final GetConfigResponse getConfigResponse;
  initializeIfNeeded();
  response=sendAction(new GetConfigAction(filename));
  if (!(response instanceof GetConfigResponse)) {
    throw new ManagerCommunicationException("Response to GetConfigAction(\"" + filename + "\") was not a CommandResponse but "+ response,null);
  }
  getConfigResponse=(GetConfigResponse)response;
  final Map<String,List<String>> categories=new LinkedHashMap<String,List<String>>();
  final Map<Integer,String> categoryMap=getConfigResponse.getCategories();
  for (  Map.Entry<Integer,String> categoryEntry : categoryMap.entrySet()) {
    final List<String> lines;
    final Map<Integer,String> lineMap=getConfigResponse.getLines(categoryEntry.getKey());
    if (lineMap == null) {
      lines=new ArrayList<String>();
    }
 else {
      lines=new ArrayList<String>(lineMap.values());
    }
    categories.put(categoryEntry.getValue(),lines);
  }
  return new ConfigFileImpl(filename,categories);
}
