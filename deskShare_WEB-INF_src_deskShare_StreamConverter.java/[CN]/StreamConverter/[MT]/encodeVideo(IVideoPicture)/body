{
  int retval;
  IPacket oPacket=IPacket.make();
  IVideoPicture preEncode=picture;
  if (mVideoPictureListener != null) {
    try {
      preEncode=mVideoPictureListener.preEncode(picture);
      if (preEncode == null)       preEncode=picture;
    }
  finally {
    }
  }
  int numBytesConsumed=0;
  if (preEncode.isComplete()) {
    log.debug("ready to encode video");
    try {
      retval=mOutVideoCoder.encodeVideo(oPacket,preEncode,0);
    }
  finally {
    }
    if (retval <= 0) {
      log.error("could not encode video picture; continuing anyway");
    }
 else {
      log.debug("encode video completed");
      numBytesConsumed+=retval;
    }
    if (oPacket.isComplete()) {
      writePacket(oPacket);
    }
  }
}
