{
  DataInputStream inStream=null;
  byte[][] buffer=new byte[10][65536];
  byte[] appendedBuffer=new byte[10 * 65536];
  try {
    inStream=new DataInputStream(socket.getInputStream());
    int bytesRead=0, index=0, totalRead=0;
    while (!socket.isClosed() && (bytesRead != -1)) {
      bytesRead=inStream.read(buffer[index]);
      index++;
      totalRead+=bytesRead;
      System.out.println("Read bytes: " + bytesRead);
    }
    for (index=0; index < 4; index++) {
      for (int i=0; i < buffer[index].length; i++) {
        appendedBuffer[index * 65536 + i]=buffer[index][i];
      }
    }
    System.out.println("Read bytes in total: " + totalRead);
    InputStream imageData=new ByteArrayInputStream(appendedBuffer);
    BufferedImage image=ImageIO.read(imageData);
    runEncoder(image);
  }
 catch (  Exception e) {
    e.printStackTrace(System.out);
  }
}
