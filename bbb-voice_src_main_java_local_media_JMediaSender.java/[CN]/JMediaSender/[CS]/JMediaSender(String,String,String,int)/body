{
  String result;
  MediaLocator media_locator;
{
    if (media == null) {
      if (type.equals("audio"))       media_locator=getAudio();
 else       media_locator=getVideo();
    }
 else     media_locator=new MediaLocator(media);
  }
  System.out.println("MediaLocator: " + media_locator.toString());
  result=createProcessor(media_locator);
  if (result != null) {
    System.out.println(result);
    return;
  }
  System.out.println("Processor created");
  processor.configure();
  while (processor.getState() < processor.Configured) {
  }
  System.out.println("Processor configured");
  if (media == null) {
    processor.setContentDescriptor(new ContentDescriptor(ContentDescriptor.RAW_RTP));
    System.out.println("ContentDescriptor=" + processor.getContentDescriptor().getContentType());
  }
 else {
    processor.setContentDescriptor(new ContentDescriptor(ContentDescriptor.RAW));
    System.out.println("ContentDescriptor=" + processor.getContentDescriptor().getContentType());
    TrackControl[] tracks=processor.getTrackControls();
    System.out.println("Number of tracks=" + tracks.length);
    boolean enabled=false;
    for (int i=0; i < tracks.length; i++) {
      TrackControl track_control=tracks[i];
      Format format=track_control.getFormat();
      System.out.println("track#" + i + " format:"+ format.toString());
      if (!enabled) {
        if (format.toString().indexOf("Stereo") > 0 || format.toString().indexOf("Mono") > 0) {
          if (type.equals("audio"))           enabled=track_control.setFormat(new AudioFormat(AudioFormat.GSM_RTP)) != null;
 else           enabled=false;
        }
 else {
          if (type.equals("video"))           enabled=track_control.setFormat(new VideoFormat(VideoFormat.H263_RTP)) != null;
 else           enabled=false;
        }
        track_control.setEnabled(enabled);
        System.out.println("track#" + i + " enabled="+ enabled);
      }
 else {
        track_control.setEnabled(false);
        System.out.println("track#" + i + " disabled");
      }
    }
  }
  processor.realize();
  while (processor.getState() < processor.Realized)   ;
  System.out.println("Processor realized");
  String media_url="rtp://" + dest_addr + ":"+ dest_port+ "/"+ type+ "/1";
  dest=new MediaLocator(media_url);
}
