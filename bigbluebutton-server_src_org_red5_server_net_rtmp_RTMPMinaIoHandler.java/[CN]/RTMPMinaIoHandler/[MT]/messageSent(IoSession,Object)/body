{
  if (log.isDebugEnabled()) {
    log.debug("messageSent");
  }
  session.getAttribute(ProtocolState.SESSION_KEY);
  final RTMPMinaConnection conn=(RTMPMinaConnection)session.getAttachment();
  handler.messageSent(conn,message);
  if (mode == RTMP.MODE_CLIENT) {
    if (message instanceof ByteBuffer) {
      if (((ByteBuffer)message).limit() == Constants.HANDSHAKE_SIZE) {
        handler.connectionOpened((RTMPMinaConnection)session.getAttachment(),(RTMP)session.getAttribute(ProtocolState.SESSION_KEY));
      }
    }
  }
}
