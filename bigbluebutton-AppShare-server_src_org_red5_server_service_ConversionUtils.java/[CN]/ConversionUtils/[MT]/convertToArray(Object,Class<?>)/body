{
  try {
    Object[] targetInstance=(Object[])Array.newInstance(target.getComponentType(),0);
    if (source.getClass().isArray()) {
      Object[] sourceArray=(Object[])source;
      Class<?> targetType=target.getComponentType();
      List<Object> list=new ArrayList<Object>(sourceArray.length);
      for (      Object element : sourceArray) {
        list.add(convert(element,targetType));
      }
      source=list;
    }
    if (source instanceof Collection) {
      return ((Collection<?>)source).toArray(targetInstance);
    }
 else {
      throw new ConversionException("Unable to convert to array");
    }
  }
 catch (  Exception ex) {
    throw new ConversionException("Error converting to array",ex);
  }
}
