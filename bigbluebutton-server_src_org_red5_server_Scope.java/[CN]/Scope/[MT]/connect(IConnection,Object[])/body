{
  logger.debug("Has connection: {}",(conn != null));
  logger.debug("Has handler: {}",(handler != null));
  logger.debug("Has parent: {}",(parent != null));
  if (hasParent() && !parent.connect(conn,params)) {
    return false;
  }
  if (hasHandler() && !getHandler().connect(conn,this,params)) {
    return false;
  }
  final IClient client=conn.getClient();
  if (!conn.isConnected()) {
    return false;
  }
  if (hasHandler() && !getHandler().join(client,this)) {
    return false;
  }
  if (!conn.isConnected()) {
    return false;
  }
  Set<IConnection> conns=clients.get(client);
  if (conns == null) {
    conns=new CopyOnWriteArraySet<IConnection>();
    clients.put(client,conns);
  }
  conns.add(conn);
  clientStats.increment();
  addEventListener(conn);
  connectionStats.increment();
  if (this.equals(conn.getScope())) {
    final IServer server=getServer();
    if (server instanceof Server) {
      ((Server)server).notifyConnected(conn);
    }
  }
  return true;
}
