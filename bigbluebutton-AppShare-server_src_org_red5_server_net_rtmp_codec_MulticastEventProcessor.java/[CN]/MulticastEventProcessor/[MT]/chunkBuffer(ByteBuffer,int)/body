{
  final int num=(int)Math.ceil(buf.limit() / (float)size);
  final ByteBuffer[] chunks=new ByteBuffer[num];
  for (int i=0; i < num; i++) {
    chunks[i]=buf.asReadOnlyBuffer();
    final ByteBuffer chunk=chunks[i];
    int position=size * num;
    chunk.position(position);
    if (position + size < chunk.limit()) {
      chunk.limit(position + size);
    }
  }
  return chunks;
}
