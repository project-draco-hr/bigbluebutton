{
  String source=pres.getUploadedFile().getAbsolutePath();
  String dest;
  String COMMAND="";
  if (SupportedFileTypes.isImageFile(pres.getFileType())) {
    dest=thumbsDir.getAbsolutePath() + File.separator + TEMP_THUMB_NAME+ ".png";
    COMMAND=IMAGEMAGICK_DIR + "/convert -thumbnail 150x150 " + source+ " "+ dest;
  }
 else {
    dest=thumbsDir.getAbsolutePath() + File.separator + "thumb-";
    COMMAND=IMAGEMAGICK_DIR + "/gs -q -sDEVICE=pngalpha -dBATCH -dNOPAUSE -dNOPROMPT -dDOINTERPOLATE -dPDFFitPage -r16 -sOutputFile=" + dest+ "%d.png "+ source;
  }
  Process p;
  try {
    p=Runtime.getRuntime().exec(COMMAND);
    log.debug("begin waiting for... " + source + " "+ dest);
    int exitValue=p.waitFor();
    log.debug("finish waiting for... " + source);
    if (exitValue != 0) {
      log.warn("Exit Value != 0 while for " + COMMAND);
    }
 else {
      return true;
    }
  }
 catch (  IOException e) {
    log.error("IOException while processing " + COMMAND);
  }
  log.warn("Failed to create thumbnails: " + COMMAND);
  return false;
}
