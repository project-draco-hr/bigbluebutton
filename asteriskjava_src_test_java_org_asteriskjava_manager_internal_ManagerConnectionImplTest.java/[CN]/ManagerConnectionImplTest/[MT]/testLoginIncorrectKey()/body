{
  mockSocket.close();
  replay(mockSocket);
  mockWriter.setExpectedUsername("username");
  mockWriter.setExpectedKey("40b1b887502902a8ce61a16e44630f7c");
  mc.setUsername("username");
  mc.setPassword("wrong password");
  try {
    mc.login();
    fail("No AuthenticationFailedException thrown");
  }
 catch (  AuthenticationFailedException e) {
  }
  assertEquals("createSocket not called 1 time",1,mc.createSocketCalls);
  assertEquals("createWriter not called 1 time",1,mc.createWriterCalls);
  assertEquals("createReader not called 1 time",1,mc.createReaderCalls);
  assertEquals("challenge action not sent 1 time",1,mockWriter.challengeActionsSent);
  assertEquals("login action not sent 1 time",1,mockWriter.loginActionsSent);
  assertEquals("unexpected other actions sent",0,mockWriter.otherActionsSent);
  assertEquals("setSocket() not called 1 time",1,mockReader.setSocketCalls);
  try {
    Thread.sleep(100);
  }
 catch (  InterruptedException e) {
    Thread.sleep(100);
  }
  assertEquals("run() not called 1 time",1,mockReader.runCalls);
  assertEquals("unexpected call to die()",0,mockReader.dieCalls);
  verify(mockSocket);
}
