{
  if (log.isDebugEnabled()) {
    log.debug("Session created");
  }
  RTMP rtmp=new RTMP(mode);
  session.setAttribute(ProtocolState.SESSION_KEY,rtmp);
  session.getFilterChain().addFirst("protocolFilter",new ProtocolCodecFilter(this.codecFactory));
  if (log.isDebugEnabled()) {
    session.getFilterChain().addLast("logger",new LoggingFilter());
  }
  RTMPMinaConnection conn=createRTMPMinaConnection();
  conn.setIoSession(session);
  conn.setState(rtmp);
  session.setAttachment(conn);
}
