{
  if (session.containsAttribute(EVENT_TYPE)) {
    Integer eventType=(Integer)session.getAttribute(EVENT_TYPE);
    boolean receiveDone=false;
switch (eventType.intValue()) {
case CAPTURE_START_EVENT:
      receiveDone=decodeCaptureStartEvent(session,in,out);
    break;
case CAPTURE_UPDATE_EVENT:
  receiveDone=decodeCaptureUpdateEvent(session,in,out);
break;
case CAPTURE_END_EVENT:
break;
}
if (receiveDone) {
long receiveComplete=System.currentTimeMillis();
System.out.println("Receive took " + (receiveComplete - receiveStart) + "ms.");
}
}
 else {
if (in.remaining() < 10) return false;
byte[] header=new byte[HEADER_LENGTH];
in.get(header,0,HEADER_LENGTH);
int event=in.get();
System.out.println("Received " + header + " type "+ event);
session.setAttribute(EVENT_TYPE,new Integer(event));
receiveStart=System.currentTimeMillis();
return true;
}
return false;
}
