{
  if (rtpSocket == null) {
    println("run","RTP socket is null.");
    return;
  }
  encoder=new Encoder();
  encoderMap=new float[64];
  tempBuffer=new float[NELLYMOSER_DECODED_PACKET_SIZE];
  byte[] codedBuffer=new byte[sipCodec.getIncomingEncodedFrameSize()];
  byte[] internalBuffer=new byte[sipCodec.getIncomingEncodedFrameSize() + RTP_HEADER_SIZE];
  RtpPacket rtpPacket=new RtpPacket(internalBuffer,0);
  running=true;
  try {
    rtpSocket.getDatagramSocket().setSoTimeout(SO_TIMEOUT);
    float[] decodingBuffer=new float[sipCodec.getIncomingDecodedFrameSize()];
    int packetCount=0;
    println("run","internalBuffer.length = " + internalBuffer.length + ", codedBuffer.length = "+ codedBuffer.length+ ", decodingBuffer.length = "+ decodingBuffer.length+ ".");
    while (running) {
      try {
        rtpSocket.receive(rtpPacket);
        frameCounter++;
        if (running) {
          byte[] packetBuffer=rtpPacket.getPacket();
          int offset=rtpPacket.getHeaderLength();
          int length=rtpPacket.getPayloadLength();
          BufferUtils.byteBufferIndexedCopy(codedBuffer,0,packetBuffer,offset,sipCodec.getIncomingEncodedFrameSize());
          int decodedBytes=sipCodec.codecToPcm(codedBuffer,decodingBuffer);
          if (decodedBytes == sipCodec.getIncomingDecodedFrameSize()) {
            forwardAudioToFlashPlayer(decodingBuffer);
          }
 else {
            println("fillRtpPacketBuffer","Failure decoding buffer.");
          }
        }
      }
 catch (      java.io.InterruptedIOException e) {
      }
    }
  }
 catch (  Exception e) {
    running=false;
    e.printStackTrace();
  }
  DatagramSocket socket=rtpSocket.getDatagramSocket();
  rtpSocket.close();
  if (socketIsLocal && socket != null) {
    socket.close();
  }
  rtpSocket=null;
  println("run","Terminated.");
  println("run","Frames = " + frameCounter + ".");
}
