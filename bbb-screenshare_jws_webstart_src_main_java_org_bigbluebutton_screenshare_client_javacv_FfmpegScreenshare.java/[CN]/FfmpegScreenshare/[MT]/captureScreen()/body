{
  long now=System.currentTimeMillis();
  Frame frame;
  try {
    frame=grabber.grabImage();
    if (frame != null) {
      try {
        mainRecorder.record(frame);
      }
 catch (      Exception e) {
        System.out.println("CaptureScreen Exception 1");
        if (!ignoreDisconnect) {
          listener.networkConnectionException(ExitCode.CONNECTION_TO_DESKSHARE_SERVER_DROPPED,null);
        }
      }
    }
  }
 catch (  Exception e1) {
    System.out.println("CaptureScreen Exception 2");
    e1.printStackTrace();
  }
  long sleepFramerate=(long)(1000 / frameRate);
  long timestamp=now - startTime;
  mainRecorder.setTimestamp(timestamp * 1000);
  mainRecorder.setFrameNumber(frameNumber);
  frameNumber++;
  long execDuration=(System.currentTimeMillis() - now);
  long sleepDuration=Math.max(sleepFramerate - execDuration,0);
  pause(sleepDuration);
}
