{
  log.info("Loading tomcat context");
  try {
    getApplicationContext();
  }
 catch (  Exception e) {
    log.error("Error loading tomcat configuration",e);
  }
  if (webappFolder == null) {
    webappFolder=System.getProperty("red5.root") + "/webapps";
  }
  System.setProperty("red5.webapp.root",webappFolder);
  log.info("Application root: " + webappFolder);
  if (log.isDebugEnabled()) {
    log.debug("Approot: " + webappFolder);
  }
  File appDirBase=new File(webappFolder);
  File[] dirs=appDirBase.listFiles(new DirectoryFilter());
  for (  File dir : dirs) {
    String dirName='/' + dir.getName();
    if (null == baseHost.findChild(dirName)) {
      if (log.isDebugEnabled()) {
        log.debug("Adding context from directory scan: " + dirName);
      }
      this.addContext(dirName,webappFolder + '/' + dirName);
    }
  }
  if (log.isDebugEnabled()) {
    for (    Container cont : baseHost.findChildren()) {
      log.debug("Context child name: " + cont.getName());
    }
  }
  embedded.setRealm(realm);
  embedded.setUseNaming(false);
  engine.addChild(baseHost);
  embedded.addEngine(engine);
  embedded.addConnector(connector);
  setApplicationLoader(new TomcatApplicationLoader(embedded,baseHost,applicationContext.get()));
  try {
    log.info("Starting Tomcat servlet engine");
    embedded.start();
  }
 catch (  org.apache.catalina.LifecycleException e) {
    log.error("Error loading Tomcat",e);
  }
}
