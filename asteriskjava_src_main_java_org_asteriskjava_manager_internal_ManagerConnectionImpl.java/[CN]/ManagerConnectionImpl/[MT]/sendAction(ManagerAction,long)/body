{
  ResponseHandlerResult result;
  SendActionCallback callbackHandler;
  result=new ResponseHandlerResult();
  callbackHandler=new DefaultSendActionCallback(result);
synchronized (result) {
    sendAction(action,callbackHandler);
    if (action instanceof UserEventAction) {
      return null;
    }
    if (result.getResponse() == null) {
      try {
        result.wait(timeout);
      }
 catch (      InterruptedException ex) {
        logger.warn("Interrupted while waiting for result");
      }
    }
  }
  if (result.getResponse() == null) {
    throw new TimeoutException("Timeout waiting for response to " + action.getAction() + (action.getActionId() == null ? "" : " (actionId: " + action.getActionId() + ")"));
  }
  return result.getResponse();
}
