{
  int attempts=0;
  if ("Asterisk Call Manager/1.1".equals(protocolIdentifier.value)) {
    return AsteriskVersion.ASTERISK_1_6;
  }
  while (attempts++ < MAX_VERSION_ATTEMPTS) {
    final ManagerResponse showVersionFilesResponse;
    final List<String> showVersionFilesResult;
    showVersionFilesResponse=sendAction(new CommandAction("show version files pbx.c"),defaultResponseTimeout * 2);
    if (!(showVersionFilesResponse instanceof CommandResponse)) {
      break;
    }
    showVersionFilesResult=((CommandResponse)showVersionFilesResponse).getResult();
    if (showVersionFilesResult != null && showVersionFilesResult.size() > 0) {
      final String line1;
      line1=showVersionFilesResult.get(0);
      if (line1 != null && line1.startsWith("File")) {
        final String rawVersion;
        rawVersion=getRawVersion();
        if (rawVersion != null && rawVersion.startsWith("Asterisk 1.4")) {
          return AsteriskVersion.ASTERISK_1_4;
        }
        return AsteriskVersion.ASTERISK_1_2;
      }
 else       if (line1 != null && line1.contains("No such command")) {
        try {
          Thread.sleep(RECONNECTION_VERSION_INTERVAL);
        }
 catch (        Exception ex) {
        }
      }
 else {
        break;
      }
    }
  }
  return AsteriskVersion.ASTERISK_1_0;
}
