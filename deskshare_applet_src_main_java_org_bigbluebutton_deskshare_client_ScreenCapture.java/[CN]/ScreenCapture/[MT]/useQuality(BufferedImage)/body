{
  Graphics2D g1=image.createGraphics();
  BufferedImage resultImage=graphicsConfig.createCompatibleImage(scaleWidth,scaleHeight,Transparency.BITMASK);
  resultImage.setAccelerationPriority(1);
  Graphics2D g2=resultImage.createGraphics();
  Point mouseLoc=getMouseLocation();
  System.out.println("Drawing cursor at [" + (mouseLoc.x - x) + ","+ (mouseLoc.y - y));
  g1.drawImage(cursorImage,mouseLoc.x - x,mouseLoc.y - y,cursorImage.getWidth(null),cursorImage.getHeight(null),null);
  if (image.getWidth() < scaleWidth || image.getHeight() < scaleHeight) {
    int imgWidth=image.getWidth();
    int imgHeight=image.getHeight();
    if (imgWidth < scaleWidth && imgHeight < scaleHeight) {
      g2.drawImage(image,(resultImage.getWidth() - imgWidth) / 2,(resultImage.getHeight() - imgHeight) / 2,imgWidth,imgHeight,null);
    }
 else {
      if (imgWidth > scaleWidth) {
        double ratio=(double)imgHeight / (double)imgWidth;
        imgWidth=scaleWidth;
        imgHeight=(int)((double)imgWidth * ratio);
      }
 else {
        double ratio=(double)imgWidth / (double)imgHeight;
        imgHeight=scaleHeight;
        imgWidth=(int)((double)imgHeight * ratio);
      }
      Image scaledImage=image.getScaledInstance(imgWidth,imgHeight,Image.SCALE_AREA_AVERAGING);
      g2.drawImage(scaledImage,(resultImage.getWidth() - imgWidth) / 2,(resultImage.getHeight() - imgHeight) / 2,imgWidth,imgHeight,null);
    }
  }
 else {
    Image scaledImage=image.getScaledInstance(scaleWidth,scaleHeight,Image.SCALE_AREA_AVERAGING);
    g2.drawImage(scaledImage,0,0,scaleWidth,scaleHeight,null);
  }
  g2.dispose();
  return resultImage;
}
