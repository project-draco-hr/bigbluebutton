{
  if (audioApp != null || videoApp != null) {
    log.debug("launchMediaApplication","Media application is already running.");
    return;
  }
  if (listener != null) {
    listener.onUaCallConnected(this);
  }
  SessionDescriptor localSdp=new SessionDescriptor(call.getLocalSessionDescriptor());
  int localAudioPort=0;
  int localVideoPort=0;
  for (Enumeration e=localSdp.getMediaDescriptors().elements(); e.hasMoreElements(); ) {
    MediaField media=((MediaDescriptor)e.nextElement()).getMedia();
    if (media.getMedia().equals("audio")) {
      localAudioPort=media.getPort();
    }
    if (media.getMedia().equals("video")) {
      localVideoPort=media.getPort();
    }
  }
  log.debug("launchMediaApplication","localAudioPort = " + localAudioPort + ", localVideoPort = "+ localVideoPort+ ".");
  SessionDescriptor remoteSdp=new SessionDescriptor(call.getRemoteSessionDescriptor());
  String remoteMediaAddress=(new Parser(remoteSdp.getConnection().toString())).skipString().skipString().getString();
  int remoteAudioPort=0;
  int remoteVideoPort=0;
  for (Enumeration e=remoteSdp.getMediaDescriptors().elements(); e.hasMoreElements(); ) {
    MediaDescriptor descriptor=(MediaDescriptor)e.nextElement();
    MediaField media=descriptor.getMedia();
    if (media.getMedia().equals("audio")) {
      remoteAudioPort=media.getPort();
    }
    if (media.getMedia().equals("video")) {
      remoteVideoPort=media.getPort();
    }
  }
  log.debug("launchMediaApplication","remoteAudioPort = " + remoteAudioPort + ", remoteVideoPort = "+ remoteVideoPort+ ".");
  int dir=0;
  if (userProfile.recvOnly) {
    dir=-1;
  }
 else   if (userProfile.sendOnly) {
    dir=1;
  }
  log.debug("launchMediaApplication","user_profile.audio = " + userProfile.audio + ", user_profile.video = "+ userProfile.video+ ", audio_app = "+ audioApp+ ", video_app = "+ videoApp+ ".");
  if (userProfile.audio && localAudioPort != 0 && remoteAudioPort != 0) {
    if (audioApp == null) {
      if (sipCodec != null) {
        audioApp=new AudioLauncher(sipCodec,localAudioPort,remoteMediaAddress,remoteAudioPort,rtmpUser);
      }
 else {
        log.debug("launchMediaApplication","SipCodec not initialized.");
      }
    }
    if (audioApp != null) {
      audioApp.startMedia();
    }
  }
  if (userProfile.video && localVideoPort != 0 && remoteVideoPort != 0) {
    if (videoApp == null) {
      log.debug("launchMediaApplication","No external video application nor JMF has been provided: Video not started.");
      return;
    }
    videoApp.startMedia();
  }
}
