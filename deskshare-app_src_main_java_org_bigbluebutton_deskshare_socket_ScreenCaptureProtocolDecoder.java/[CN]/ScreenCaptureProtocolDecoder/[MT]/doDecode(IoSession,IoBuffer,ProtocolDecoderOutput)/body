{
  if (!session.containsAttribute(ROOM)) {
    return decodeRoom(session,in);
  }
 else   if (!session.containsAttribute(VIDEO_INFO)) {
    return decodeRoom(session,in);
  }
 else {
    if (canDecodeCapturedScreen(session,in)) {
      byte[] bytes=new byte[getLength(in)];
      log.debug("Reading image with length {}",bytes.length);
      in.get(bytes);
      ByteArrayInputStream bais=new ByteArrayInputStream(bytes);
      try {
        BufferedImage image=ImageIO.read(bais);
        ;
        session.setAttribute(CAPTURED_SCREEN,image);
        sendDecodedMessage(session,out);
      }
 catch (      IOException e) {
        log.error("Failed to get captured screen for room {}",(String)session.getAttribute(ROOM));
      }
      reset(session);
      return true;
    }
  }
  return false;
}
