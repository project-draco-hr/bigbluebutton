{
  Image image=ImageIO.read(infile);
  int imageWidth=image.getWidth(null);
  int imageHeight=image.getHeight(null);
  float thumbRatio=(float)thumbBounds / Math.max(imageWidth,imageHeight);
  int thumbWidth=(int)(imageWidth * thumbRatio);
  int thumbHeight=(int)(imageHeight * thumbRatio);
  BufferedImage thumbImage=new BufferedImage(thumbWidth,thumbHeight,BufferedImage.TYPE_INT_RGB);
  Graphics2D graphics2D=thumbImage.createGraphics();
  graphics2D.setRenderingHint(RenderingHints.KEY_INTERPOLATION,RenderingHints.VALUE_INTERPOLATION_BICUBIC);
  graphics2D.drawImage(image,0,0,thumbWidth,thumbHeight,null);
  ImageWriter writer=null;
  Iterator<ImageWriter> iter=ImageIO.getImageWritersByFormatName("jpg");
  if (iter.hasNext()) {
    writer=(ImageWriter)iter.next();
  }
  ImageWriteParam iwp=writer.getDefaultWriteParam();
  iwp.setCompressionMode(ImageWriteParam.MODE_EXPLICIT);
  iwp.setCompressionQuality(compressionQuality);
  ImageOutputStream ios=ImageIO.createImageOutputStream(outfile);
  writer.setOutput(ios);
  writer.write(thumbImage);
  ios.flush();
  writer.dispose();
  ios.close();
}
