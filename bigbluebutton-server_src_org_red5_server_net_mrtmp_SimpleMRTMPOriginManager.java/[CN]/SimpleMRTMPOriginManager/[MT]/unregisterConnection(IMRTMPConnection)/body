{
  boolean ret;
  ArrayList<RTMPConnection> list=new ArrayList<RTMPConnection>();
  lock.writeLock().lock();
  try {
    ret=connSet.remove(conn);
    if (ret) {
      for (Iterator<Entry<RTMPConnection,IMRTMPConnection>> iter=clientToConnMap.entrySet().iterator(); iter.hasNext(); ) {
        Entry<RTMPConnection,IMRTMPConnection> entry=iter.next();
        if (entry.getValue() == conn) {
          list.add(entry.getKey());
        }
      }
    }
  }
  finally {
    lock.writeLock().unlock();
  }
  for (  RTMPConnection rtmpConn : list) {
    log.debug("Close RTMPOriginConnection " + rtmpConn.getId() + " due to MRTMP Connection closed!");
    originMRTMPHandler.closeConnection((RTMPOriginConnection)rtmpConn);
  }
  return ret;
}
