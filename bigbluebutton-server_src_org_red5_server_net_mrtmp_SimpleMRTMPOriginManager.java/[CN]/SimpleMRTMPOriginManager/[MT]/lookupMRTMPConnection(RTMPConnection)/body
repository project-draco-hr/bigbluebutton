{
  lock.readLock().lock();
  try {
    IMRTMPConnection conn=clientToConnMap.get(rtmpConn);
    if (conn != null && !connSet.contains(conn)) {
      clientToConnMap.remove(rtmpConn);
      conn=null;
    }
    if (conn == null && !rtmpConn.getType().equals(IConnection.PERSISTENT)) {
      if (connSet.size() > 0) {
        conn=connSet.iterator().next();
      }
    }
    return conn;
  }
  finally {
    lock.readLock().unlock();
  }
}
