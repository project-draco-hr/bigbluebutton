{
  FLVReader reader=null;
  ByteBuffer fileData;
  String fileName=file.getName();
  if (cache == null) {
    System.out.println("No cache");
    log.warn("FLV cache is null, an NPE may be thrown. To fix your code, ensure a cache is set via Spring or by the following: setCache(NoCacheImpl.getInstance())");
  }
  ICacheable ic=cache.get(fileName);
  if (null == ic || (null == ic.getByteBuffer())) {
    if (file.exists()) {
      if (log.isDebugEnabled()) {
        log.debug("File size: " + file.length());
      }
      reader=new FLVReader(file,generateMetadata);
      fileData=reader.getFileData();
      if (fileData != null && cache.offer(fileName,fileData)) {
        if (log.isDebugEnabled()) {
          log.debug("Item accepted by the cache: " + fileName);
        }
      }
 else {
        if (log.isDebugEnabled()) {
          log.debug("Item will not be cached: " + fileName);
        }
      }
    }
 else {
      log.info("Creating new file: " + file);
      file.createNewFile();
    }
  }
 else {
    fileData=ByteBuffer.wrap(ic.getBytes());
    reader=new FLVReader(fileData,generateMetadata);
  }
  return reader;
}
