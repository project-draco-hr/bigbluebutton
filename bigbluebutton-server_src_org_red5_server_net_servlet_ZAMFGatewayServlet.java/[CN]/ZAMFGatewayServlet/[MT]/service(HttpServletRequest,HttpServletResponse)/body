{
  log.info("Service");
  if (req.getContentLength() == 0 || req.getContentType() == null || !req.getContentType().equals(APPLICATION_AMF)) {
    resp.setStatus(HttpServletResponse.SC_OK);
    resp.getWriter().write("Gateway");
    resp.flushBuffer();
    return;
  }
  ByteBuffer reqBuffer=null;
  try {
    reqBuffer=ByteBuffer.allocate(req.getContentLength());
    ServletUtils.copy(req.getInputStream(),reqBuffer.asOutputStream());
    reqBuffer.flip();
    VmPipeConnector connector=new VmPipeConnector();
    IoHandler handler=new Handler(req,resp);
    ConnectFuture connectFuture=connector.connect(new VmPipeAddress(5080),handler);
    connectFuture.join();
    IoSession session=connectFuture.getSession();
    session.setAttachment(resp);
    session.write(reqBuffer);
    ContinuationSupport.getContinuation(req,handler).suspend(1000);
  }
 catch (  IOException e) {
    log.error("{}",e);
  }
  log.info("End");
}
