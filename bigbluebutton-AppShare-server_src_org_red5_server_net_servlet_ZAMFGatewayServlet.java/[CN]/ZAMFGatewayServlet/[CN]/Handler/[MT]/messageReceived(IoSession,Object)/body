{
  log.info("<< message " + message);
  if (message instanceof ByteBuffer) {
    final Continuation cont=ContinuationSupport.getContinuation(req,this);
    if (cont.isPending()) {
      cont.resume();
    }
    try {
      final ServletOutputStream out=resp.getOutputStream();
      ByteBuffer buf=(ByteBuffer)message;
      resp.setStatus(HttpServletResponse.SC_OK);
      resp.setContentType(req.getContentType());
      resp.setContentLength(buf.limit());
      ServletUtils.copy(buf.asInputStream(),out);
      out.flush();
      out.close();
    }
 catch (    IOException e) {
      log.error("Error sending response",e);
    }
  }
}
