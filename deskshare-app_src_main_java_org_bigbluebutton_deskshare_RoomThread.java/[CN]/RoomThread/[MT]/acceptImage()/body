{
  if (socket.isClosed()) {
    keepCapturing=false;
    return;
  }
  DataInputStream inStream=null;
  try {
    inStream=new DataInputStream(socket.getInputStream());
    int totalBytes=inStream.readInt();
    System.out.println("Receiving " + totalBytes + " bytes");
    if (totalBytes > 1000000 || totalBytes <= 0)     return;
    byte[] appendedBuffer=new byte[totalBytes];
    inStream.readFully(appendedBuffer);
    InputStream imageData=new ByteArrayInputStream(appendedBuffer);
    BufferedImage image=ImageIO.read(imageData);
    if (image == null)     return;
    notifyListeners(image);
  }
 catch (  Exception e) {
    e.printStackTrace(System.out);
    keepCapturing=false;
    return;
  }
}
