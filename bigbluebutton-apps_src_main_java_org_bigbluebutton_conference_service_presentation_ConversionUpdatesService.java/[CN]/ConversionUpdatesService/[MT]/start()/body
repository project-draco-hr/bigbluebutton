{
  Thread thread=new Thread(new Runnable(){
    @Override public void run(){
      log.info("{} - Will wait for document conversion updates messages.",APP);
      while (waitForMessage) {
        Message jmsMessage=template.receive(destination);
        log.debug("{} - Got JMS message.",APP);
        if (jmsMessage instanceof MapMessage) {
          try {
            MapMessage mapMessage=((MapMessage)jmsMessage);
            String code=mapMessage.getString("returnCode");
            String room=mapMessage.getString("room");
            String presentationName=mapMessage.getString("presentationName");
            Map message=new HashMap();
            message.put("room",room);
            message.put("code",code);
            message.put("presentationName",presentationName);
            if (code.equalsIgnoreCase("SUCCESS")) {
              log.debug("JMS: SUCCESS[{}]",presentationName);
              message.put("message",mapMessage.getStringProperty("message"));
              presentationApplication.sendUpdateMessage(message);
            }
 else             if (code.equalsIgnoreCase("FAILED_CONVERT_FORMAT") || code.equalsIgnoreCase("FAILED_CONVERT_NOT_SUPPORTED") || code.equalsIgnoreCase("FAILED_CONVERT_SOFFICE")|| code.equalsIgnoreCase("FAILED_CONVERT_NBPAGE")|| code.equalsIgnoreCase("FAILED_CONVERT_MAXNBPAGE_REACH")|| code.equalsIgnoreCase("FAILED_CONVERT_SWF")|| code.equalsIgnoreCase("FAILED_CONVERT_SWF_IMAGE")|| code.equalsIgnoreCase("FAILED_CONVERT_SWF_PDF")|| code.equalsIgnoreCase("FAILED_CONVERT_THUMBNAIL")) {
              log.debug("JMS: {}[{}]",code,presentationName);
              presentationApplication.sendUpdateMessage(message);
            }
 else             if (code.equalsIgnoreCase("FAILED") || code.equalsIgnoreCase("FAILED_CONVERT")) {
              log.debug("JMS: FAILED[{}]",presentationName);
              message.put("message",mapMessage.getStringProperty("message"));
              presentationApplication.sendUpdateMessage(message);
            }
 else             if (code.equalsIgnoreCase("EXTRACT") || code.equalsIgnoreCase("CONVERT")) {
              int totalSlides=mapMessage.getInt("totalSlides");
              int completedSlides=mapMessage.getInt("slidesCompleted");
              message.put("totalSlides",totalSlides);
              message.put("completedSlides",completedSlides);
              log.debug("JMS: CONVERT[" + presentationName + ", "+ completedSlides+ ", "+ totalSlides+ "]");
              presentationApplication.sendUpdateMessage(message);
            }
 else {
              log.error("Cannot handle recieved message.");
            }
          }
 catch (          JMSException ex) {
            throw new RuntimeException(ex);
          }
        }
      }
    }
  }
);
  thread.start();
}
