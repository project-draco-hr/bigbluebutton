{
  File tmpFile=File.createTempFile("setMeta_",".flv");
  if (metaService == null) {
    metaService=new MetaService(file);
  }
  metaService.setInStream(new FileInputStream(file));
  metaService.setOutStream(new FileOutputStream(tmpFile));
  if (((MetaService)metaService).getFile() == null) {
    ((MetaService)metaService).setFile(file);
  }
  metaService.write(meta);
  metaData=meta;
  file.delete();
  if (!tmpFile.renameTo(file)) {
    FileInputStream fis=new FileInputStream(tmpFile);
    FileOutputStream fos=new FileOutputStream(file);
    byte[] buf=new byte[16384];
    int i=0;
    while ((i=fis.read(buf)) != -1) {
      fos.write(buf,0,i);
    }
    fis.close();
    fos.close();
    tmpFile.delete();
  }
}
