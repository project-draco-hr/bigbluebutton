{
  log.debug("SIPUser hangup");
  CallAgent ca=callManager.remove(clientId);
  String destination;
  if (ca != null) {
    destination=ca.getDestination();
  }
 else {
    destination=clientId;
  }
  if (ca != null) {
    if (ca.isTalking()) {
      ca.hangup();
    }
 else {
      GlobalCall.removeUser(destination);
      ca.hangup();
      if (GlobalCall.roomHasGlobalStream(destination) && GlobalCall.getNumberOfUsers(destination) <= 0) {
        CallAgent caGlobal=callManager.removeGlobal(destination);
        GlobalCall.removeRoom(destination);
        caGlobal.hangup();
      }
    }
  }
}
