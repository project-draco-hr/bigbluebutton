{
  processBlocks=true;
  while (processBlocks) {
    EncodedBlockData block;
    try {
      block=retriever.fetchNextBlockToSend();
      BlockVideoData bv=new BlockVideoData(room,block.getPosition(),block.getVideoData(),false);
      sendBlock(bv);
    }
 catch (    InterruptedException e) {
      e.printStackTrace();
    }
  }
  try {
    outstream.close();
    outstream=null;
    socket.close();
  }
 catch (  IOException e) {
    e.printStackTrace();
  }
}
